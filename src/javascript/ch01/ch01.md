## 리팩터링: 첫 번째 예시

먼저 책의 예제처럼 자바스크립트로 작성 후 자바로 작성해보자. 작성해보려고 하니 테스트 프레임워크가 필요하다. Junit 말고는 써본 적이 없는데 이런... vitest는 vite를 사용하고 있을 때 유용하니 그냥 간단하게 Jest로 테스트 코드를 작성해보자.

- javascript에는 빌트인 JSON 파서가 있어서 `.json`파일을 쉽게 처리할 수 있었다. (갑자기 자바로 포팅하기 귀찮아졌다.)
- 리팩터링할 때 가장 먼저 해야할 것은 구조를 올바르게 잡는 것.
- 마틴 파울러는 가장 처음 변경의 시점, 변경의 이유를 근거하여 리팩터링을 시작한다. (토비의 스프링 6강의가 오버랩됐었다.)
- 역시 켄트벡과 영혼의 단짝이라 그런가. 테스트를 굉장히 강조한다. 나 역시 책을 보고 따라침에도 불구하고 테스트때문에 에러를 피할 수 있었다.
- 큰 형님이신 워드 커닝햄의 말씀은 항상 귀 기울여야 한다. 로직이 있는 코드는 분석해서 까먹기 전에 코드에 반영하라고 한다. 이어서 마틴 파울러는 추출한 함수가 무엇(what)을 하는건지 신경을 써서 그 함수의 이름을 붙인다.
- 코드의 가로줄이 길어지더라도 간단해보이는 것들(예. `const play = playFor(perf)`)은 인라인을 적극적으로 쓴다.
- 평상시에 가끔가다가 리팩터링을 하면서 리듬이 끊기는 부분이 많았는데, p.47에서 아하 모먼트가 있었다. 뭔가 '따로 떨어뜨리면서까지 분리를 해야할까?'라고 평소에 고민을 많이 했던 부분이라 바로 와닿을 수 있었다. case by case이긴 하겠지만, 대부분 가독성을 더 신경써야겠다.
- 리팩터링 국민 콤보 
  1. 반복문 쪼개기
  2. 문장 슬라이스
  3. 함수 추출
  4. 변수 인라인
- 평소에 반복문 리팩터링할 때, 이렇게 `반복문을 파이프라인으로 바꾸기`의 절차를 밟는데 이게 습관이 너무 몸에 새겨져서 파이프라인형태로 바로 작성을 못하는 경향이 있다. 반가웠다.
- 두번째 아하 모먼트는 다형성을 활용할 때에서 나왔다.
  - `throw '오류발생'`과 같이 편집증 프로그래머 버전을 선보인다.
  - `throw new Error('서브클래스에서 처리하도록 설계되었습니다.');` 
  - 위 두 개의 모습을 보면서 코드 자체를 문서화하고 싶어한다는 느낌이 들었다. 이런게 주석을 필요로 하지 않게 작성하는 코드이지 않나 싶다. 맥락이 코드 안에 있다.
  - ComedyCalculator#volumeCredits 를 보고 다형성을 야무지게 사용하는구나 생각했다.
